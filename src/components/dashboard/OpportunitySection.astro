---
import UnifiedOpportunityCard from "./UnifiedOpportunityCard.astro";

export interface Opportunity {
	id: number;
	title: string;
	description: string;
	subreddit: string;
	impactScore: number;
	timeText: string;
}

export interface Props {
	title: string;
	icon: string;
	count: string;
	opportunities: Opportunity[];
	footerLink: string;
	footerText: string;
	variant?: 'default' | 'saved';
}

const {
	title,
	icon,
	count,
	opportunities,
	footerLink,
	footerText,
	variant = 'default'
} = Astro.props;

const showRemoveButton = variant === 'saved';
// Limit to maximum 5 opportunities for display
const displayOpportunities = opportunities.slice(0, 5);
---

<div class="section">
	<div class="section-header">
		<h3>{icon} {title}</h3>
		<span class="section-count">{count}</span>
	</div>
	<div class="section-content">
		{displayOpportunities.map(opportunity => (
			<UnifiedOpportunityCard
				id={opportunity.id}
				title={opportunity.title}
				description={opportunity.description}
				subreddit={opportunity.subreddit}
				impactScore={opportunity.impactScore}
				timeText={opportunity.timeText}
				variant={variant}
				showRemoveButton={showRemoveButton}
				source="dashboard_component"
			/>
		))}
	</div>
	<div class="section-footer">
		<a href={footerLink} class="view-all-link">{footerText} â†’</a>
	</div>
</div>

<style lang="scss">
	.section {
		background: var(--bg-primary);
		border: 1px solid var(--border-color);
		border-radius: 12px;
		overflow: hidden;
		display: flex;
		flex-direction: column;
		min-height: 400px;

		.section-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 1.5rem 1.5rem 1rem 1.5rem;
			border-bottom: 1px solid var(--border-color);
			flex-shrink: 0;

			h3 {
				color: var(--text-primary);
				margin: 0;
				font-size: 1.2rem;
				font-weight: 600;
			}

			.section-count {
				color: var(--text-secondary);
				font-size: 0.875rem;
				background: var(--bg-secondary);
				padding: 0.25rem 0.75rem;
				border-radius: 12px;
			}
		}

		.section-content {
			padding: 1rem;
			display: flex;
			flex-direction: column;
			gap: 1rem;
			flex: 1;
			overflow-y: auto;
		}

		.section-footer {
			padding: 1rem 1.5rem;
			border-top: 1px solid var(--border-color);
			text-align: center;
			flex-shrink: 0;
			margin-top: auto;

			.view-all-link {
				color: var(--accent-primary, #6366f1);
				text-decoration: none;
				font-weight: 500;
				font-size: 0.9rem;
				transition: color 0.2s ease;

				&:hover {
					color: var(--accent-secondary, #8b5cf6);
				}
			}
		}
	}
</style>