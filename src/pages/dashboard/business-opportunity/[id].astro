---
import DashboardLayout from "../../../layouts/DashboardLayout.astro";
import BusinessOpportunityDetails from "../../../components/dashboard/BusinessOpportunityDetails.tsx";
const { id } = Astro.params;
console.log('Astro [id].astro - received id param:', id);
---

<DashboardLayout>
  <BusinessOpportunityDetails opportunityId={id || "1"} client:load />
</DashboardLayout>

<!-- Client-side API test script for browser console -->
<script>
	console.log('üåê [CLIENT] Starting browser-side API test...');
	
	// Test the API directly from the client side (with authentication)
	(async () => {
		try {
			console.log('üîÑ [CLIENT] Testing business-opportunities API from browser...');
			const response = await fetch('/api/database/business-opportunities?subredditId=1&page=1&limit=3');
			const data = await response.json();
			
			console.log('‚úÖ [CLIENT] Browser API Response Status:', response.status);
			console.log('üìä [CLIENT] Browser API Response Data:', data);
			
			if (data.success) {
				console.log(`üéØ [CLIENT] Browser found ${data.data.length} opportunities out of ${data.pagination.totalCount} total`);
				console.log('üìë [CLIENT] Pagination details:', data.pagination);
				console.log('üîç [CLIENT] Applied filters:', data.filters);
				
				// Log each opportunity
				data.data.forEach((opp: any, index: number) => {
					console.log(`üìù [CLIENT] Opportunity ${index + 1}:`, {
						id: opp.id,
						title: opp.title,
						score: opp.score,
						keywords: opp.keywords,
						source: opp.source
					});
				});
			} else {
				console.warn('‚ö†Ô∏è [CLIENT] API returned success: false');
			}
		} catch (error) {
			console.error('‚ùå [CLIENT] Browser API test failed:', error);
		}
	})();
</script>


<style lang="scss">
	// Analysis Dashboard Styles with Dark Theme Support
	:global(.analysis-dashboard) {
		max-width: 1000px;
		margin: 0 auto;
		width: 100%;
		padding: 1.5rem;
		display: flex;
		flex-direction: column;
		gap: 2rem;
	}

	// Top Metrics Row
	:global(.metrics-row) {
		display: grid;
		grid-template-columns: repeat(4, 1fr);
		gap: 1rem;

		@media (max-width: 768px) {
			grid-template-columns: repeat(2, 1fr);
		}

		@media (max-width: 480px) {
			grid-template-columns: 1fr;
		}
	}

	:global(.metric-card) {
		background: var(--bg-primary, white);
		border: 1px solid var(--border-color, #e5e7eb);
		border-radius: 12px;
		padding: 1.5rem;
		text-align: center;
		box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
		transition: all 0.2s ease;

		&:hover {
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
			transform: translateY(-1px);
		}
	}

	:global(.metric-icon) {
		font-size: 2rem;
		margin-bottom: 0.5rem;
		display: block;
	}

	:global(.metric-number) {
		font-size: 2.5rem;
		font-weight: 700;
		color: var(--text-primary, #1f2937);
		margin-bottom: 0.25rem;
		line-height: 1;
	}

	:global(.metric-label) {
		font-size: 0.875rem;
		color: var(--text-secondary, #6b7280);
		font-weight: 500;
	}

	// Opportunity Container
	:global(.opportunity-container) {
		background: var(--bg-primary, white);
		border: 1px solid var(--border-color, #e5e7eb);
		border-radius: 16px;
		overflow: hidden;
		box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.1);
	}

	// Opportunity Header
	:global(.opportunity-header) {
		padding: 2rem;
		border-bottom: 1px solid var(--border-color, #e5e7eb);
		background: linear-gradient(135deg, var(--bg-primary, white) 0%, var(--bg-secondary, #f9fafb) 100%);
	}

	:global(.main-title) {
		font-size: 2.5rem;
		font-weight: 700;
		color: var(--text-primary, #1f2937);
		margin: 0 0 1rem 0;
		line-height: 1.2;

		@media (max-width: 768px) {
			font-size: 2rem;
		}
	}

	:global(.main-description) {
		font-size: 1.125rem;
		color: var(--text-secondary, #4b5563);
		margin: 0 0 1.5rem 0;
		line-height: 1.6;
	}

	// Impact Section
	:global(.impact-section) {
		display: flex;
		align-items: center;
		gap: 1rem;
		flex-wrap: wrap;
	}

	:global(.impact-label) {
		font-size: 1rem;
		color: var(--text-secondary, #6b7280);
		font-weight: 600;
	}

	:global(.impact-bar) {
		flex: 1;
		min-width: 200px;
		height: 12px;
		background: var(--bg-tertiary, #e5e7eb);
		border-radius: 6px;
		overflow: hidden;
	}

	:global(.impact-fill) {
		height: 100%;
		background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
		border-radius: 6px;
		transition: width 0.3s ease;
	}

	:global(.impact-score) {
		font-size: 1.125rem;
		font-weight: 700;
		color: var(--text-primary, #1f2937);
		min-width: 60px;
	}

	// Section Styles
	:global(.keywords-section), 
	:global(.solutions-section), 
	:global(.sources-section) {
		padding: 2rem;
		border-bottom: 1px solid var(--border-color, #e5e7eb);

		&:last-child {
			border-bottom: none;
		}
	}

	:global(.section-title) {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		font-size: 1.5rem;
		font-weight: 600;
		color: var(--text-primary, #1f2937);
		margin: 0 0 1.5rem 0;
	}

	:global(.section-icon) {
		font-size: 1.75rem;
	}

	// Enhanced Keywords Section
	:global(.keywords-grid) {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
	}

	:global(.keyword-badge) {
		display: inline-block;
		padding: 0.5rem 1rem;
		background: linear-gradient(135deg, var(--accent-primary, #6366f1) 0%, var(--accent-secondary, #8b5cf6) 100%);
		color: white;
		border-radius: 25px;
		font-size: 0.875rem;
		font-weight: 600;
		border: none;
		box-shadow: 0 2px 4px rgba(99, 102, 241, 0.2);
		transition: all 0.2s ease;

		&:hover {
			transform: translateY(-1px);
			box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
		}
	}

	// Enhanced Solutions Section
	:global(.solutions-grid) {
		display: grid;
		gap: 1.5rem;
	}

	:global(.solution-card) {
		background: var(--bg-secondary, #f9fafb);
		border: 1px solid var(--border-color, #e5e7eb);
		border-radius: 12px;
		padding: 1.5rem;
		transition: all 0.3s ease;
		position: relative;
		overflow: hidden;

		&:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
			border-color: var(--accent-primary, #6366f1);
		}

		&::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 4px;
			background: linear-gradient(90deg, var(--accent-primary, #6366f1), var(--accent-secondary, #8b5cf6));
		}
	}

	:global(.solution-header) {
		display: flex;
		align-items: flex-start;
		gap: 1rem;
		margin-bottom: 1rem;
	}

	:global(.solution-number) {
		width: 40px;
		height: 40px;
		background: linear-gradient(135deg, var(--accent-primary, #6366f1), var(--accent-secondary, #8b5cf6));
		color: white;
		border-radius: 10px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-weight: 700;
		font-size: 1.125rem;
		flex-shrink: 0;
		box-shadow: 0 2px 4px rgba(99, 102, 241, 0.3);
	}

	:global(.solution-title) {
		font-size: 1.25rem;
		font-weight: 600;
		color: var(--text-primary, #1f2937);
		margin: 0;
		line-height: 1.3;
	}

	:global(.solution-description) {
		color: var(--text-secondary, #4b5563);
		margin: 0 0 1rem 0;
		line-height: 1.6;
		font-size: 1rem;
	}

	:global(.solution-meta) {
		display: flex;
		gap: 0.75rem;
		flex-wrap: wrap;
	}

	:global(.meta-badge) {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 0.75rem;
		background: var(--bg-primary, white);
		color: var(--text-primary, #374151);
		border-radius: 8px;
		font-size: 0.875rem;
		font-weight: 500;
		border: 1px solid var(--border-color, #d1d5db);

		&.market {
			background: linear-gradient(135deg, #d1fae5, #a7f3d0);
			color: #065f46;
			border-color: #6ee7b7;
		}

		&.model {
			background: linear-gradient(135deg, #dbeafe, #93c5fd);
			color: #1e40af;
			border-color: #60a5fa;
		}

		&.upvotes {
			background: linear-gradient(135deg, #dcfce7, #bbf7d0);
			color: #166534;
			border-color: #86efac;
		}
	}

	:global(.meta-icon) {
		font-size: 1rem;
	}

	// Sources Section
	:global(.source-category) {
		margin-bottom: 1.5rem;
		border: 1px solid var(--border-color, #e5e7eb);
		border-radius: 12px;
		overflow: hidden;

		&:last-child {
			margin-bottom: 0;
		}
	}

	:global(.expand-header) {
		width: 100%;
		padding: 1rem 1.5rem;
		background: var(--bg-secondary, #f9fafb);
		border: none;
		display: flex;
		align-items: center;
		gap: 0.75rem;
		cursor: pointer;
		transition: background-color 0.2s ease;
		font-size: 1rem;
		font-weight: 600;
		color: var(--text-primary, #374151);

		&:hover {
			background: var(--bg-tertiary, #f3f4f6);
		}
	}

	:global(.expand-icon) {
		font-size: 1.25rem;
	}

	:global(.expand-arrow) {
		margin-left: auto;
		font-size: 0.875rem;
		color: var(--text-secondary, #6b7280);
		transition: transform 0.2s ease;
	}

	:global(.expand-content) {
		padding: 1.5rem;
		background: var(--bg-primary, white);
		border-top: 1px solid var(--border-color, #e5e7eb);
	}

	// Source Items
	:global(.source-item) {
		padding: 1rem 0;
		border-bottom: 1px solid var(--border-color, #e5e7eb);

		&:last-child {
			border-bottom: none;
			padding-bottom: 0;
		}

		&:first-child {
			padding-top: 0;
		}

		&.comment-item {
			background: var(--bg-secondary, #f9fafb);
			border-radius: 8px;
			padding: 1rem;
			margin-bottom: 1rem;

			&:last-child {
				margin-bottom: 0;
			}
		}
	}

	:global(.source-title) {
		display: block;
		font-size: 1rem;
		font-weight: 600;
		color: var(--accent-primary, #6366f1);
		text-decoration: none;
		margin-bottom: 0.75rem;
		line-height: 1.4;

		&:hover {
			color: var(--accent-secondary, #4f46e5);
			text-decoration: underline;
		}
	}

	:global(.comment-content) {
		color: var(--text-primary, #1f2937);
		margin-bottom: 0.75rem;
		font-style: italic;
		line-height: 1.6;
		font-size: 1rem;
		padding: 0.75rem;
		background: var(--bg-primary, white);
		border-radius: 6px;
		border-left: 4px solid var(--accent-primary, #6366f1);
	}

	:global(.source-meta) {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}

	// Loading and Error States
	:global(.loading-state), :global(.error-state) {
		text-align: center;
		padding: 3rem 2rem;
		color: var(--text-secondary, #6b7280);
	}

	:global(.loading-spinner) {
		width: 40px;
		height: 40px;
		border: 4px solid var(--border-color, #e5e7eb);
		border-top: 4px solid var(--accent-primary, #6366f1);
		border-radius: 50%;
		animation: spin 1s linear infinite;
		margin: 0 auto 1rem;
	}

	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}

	:global(.error-state) {
		background: var(--bg-error, #fef2f2);
		border-radius: 12px;
		border: 1px solid var(--border-error, #fecaca);
		color: var(--text-error, #b91c1c);

		h3 {
			margin: 0 0 0.5rem 0;
		}

		p {
			margin: 0;
		}
	}

	// Dark Theme Support
	@media (prefers-color-scheme: dark) {
		:global(.analysis-dashboard) {
			--bg-primary: #1f2937;
			--bg-secondary: #374151;
			--bg-tertiary: #4b5563;
			--text-primary: #f9fafb;
			--text-secondary: #d1d5db;
			--border-color: #4b5563;
			--accent-primary: #6366f1;
			--accent-secondary: #8b5cf6;
			--bg-error: #1f1f1f;
			--border-error: #374151;
			--text-error: #f87171;
		}

		:global(.metric-card) {
			box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);

			&:hover {
				box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
			}
		}

		:global(.opportunity-container) {
			box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.3);
		}

		:global(.solution-card) {
			&:hover {
				box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
			}
		}

		:global(.keyword-badge) {
			box-shadow: 0 2px 4px rgba(99, 102, 241, 0.4);

			&:hover {
				box-shadow: 0 4px 8px rgba(99, 102, 241, 0.5);
			}
		}
	}

	// Responsive Design
	@media (max-width: 768px) {
		:global(.analysis-dashboard) {
			padding: 1rem;
			gap: 1.5rem;
		}

		:global(.opportunity-header) {
			padding: 1.5rem;
		}

		:global(.keywords-section), 
		:global(.solutions-section), 
		:global(.sources-section) {
			padding: 1.5rem;
		}

		:global(.impact-section) {
			flex-direction: column;
			align-items: flex-start;
			gap: 0.75rem;
		}

		:global(.impact-bar) {
			min-width: 100%;
		}

		:global(.solution-header) {
			flex-direction: column;
			gap: 0.75rem;
		}

		:global(.solution-number) {
			align-self: flex-start;
		}
	}
</style>
